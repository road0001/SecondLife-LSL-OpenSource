# Open Toys HUD设计文档

此HUD旨在设计成为一个全能的玩具分发和控制工具。您可通过Installer安装喜欢的玩具，并将它们分发给你的好友。与此同时，HUD还将与您的Holder互动，令其做出动作、粒子特效，令分发的过程更加沉浸。

HUD设计支持隐藏和展开。

## HUD功能

1. 玩具的安装、选择和捕获

	1.1. 安装

	- 穿戴Installer并点击，Installer将卸载已安装的同名玩具。
	- 实现细节见下文。

	1.2. 选择玩家

	- 点击HUD的PLAYER按钮，弹出附近玩家选择对话框进行选择。
	- 您也可以通过摄像机对准玩家进行选择。
		- 当摄像机对准玩家时，玩家的名字将显示在HUD中。
		- 点击锁定按钮，将将目标锁定为此玩家。再次点击锁定按钮解锁。

	1.3. 选择玩具

	- 点击HUD的TOY按钮，弹出玩具选择对话框进行选择。
	- 选择之后，玩具名将在对应栏位显示。

	1.4. 捕获

	- 点击HUD的CAPTURE按钮，如果之前没有选定目标（摄像机正对的不是玩家），则会弹出附近玩家选择对话框进行选择。
	- 已选择目标时，玩具的单个或多个物件（由配置决定）将自动给予对方并附加（通过RLV或AVSitter体验）。
	- Holder将根据配置，发出对应的特效。
	- HUD发送配置写入协议指令。此协议为开放式协议。
		- HUD发送玩具名字、目标UUID、所有者UUID、权限配置等数据。
		- 玩具收到后，将更新自身配置，并设置HUD所有者为主人。
		- 此配置只会更新一次，作为初始数据。

2. 玩具的控制

	- 首先选择玩家。通过PLAYER、摄像机等方式选中玩家。
	- 点击CONTROL按钮。若未选择玩家，则会弹出附近玩家选择对话框进行选择。
	- 已选择目标时，将弹出当前玩家拥有的玩具列表。
	- 选择其中一个玩具进行控制，即可打开对应菜单。
		- 玩具与HUD的通信采用开放式协议。
		- HUD发出玩具的检索信息，其中包含所有者的UUID。
		- 玩具在协议中回报玩具的名字、玩家的UUID、玩具主人的UUID。
		- HUD过滤掉主人不属于所有者的玩家和玩具。
	- 您也可以使用聊天命令来打开菜单，或直接使用指令来执行相应功能：/1 <prefix> <toyname>
		- 例如：/1 jm bubble、/1 jm cuffs lock、/1 jm collar leash

3. 玩具的配置和打包

	3.1. 玩具的配置

	- 玩具使用记事卡进行配置，记事卡的内容如下：
		- 第一行为玩具的完整名字。它将显示在玩具选择列表。
		- 第二行为玩具的短名字。如果短名不存在或为空，则和完整名字一样。命名规则遵从SL库存要求。
		- 记事卡的名字为config。
	- ```lsl
	  Toy's Name
	  toy
	  [Objects]
	  # 玩具的库存。此处列出的为所有需要物件的名字，它们将被同时给予目标并穿戴。
	  Toy Object 1
	  Toy Object 2
	  Toy Object 3
	  [Configs]
	  # 玩具的配置。不同的玩具有不同的配置，请根据玩具的需求酌情配置。
	  PUBLIC=1
	  GROUP=0
	  HARDCORE=0
	  AUTOLOCK=0
	  EXTCONFIG1=ExtendConfig1Data
	  EXTCONFIG2=ExtendConfig2Data
	  ```

	3.2. 玩具的打包

	- 玩具使用Instller脚本进行安装，将Installer脚本、配置记事卡和所需物品放入包裹库存中即可。

4. 玩具的安装与卸载

	4.1. 玩具的安装

	- 穿戴打包好的玩具Installer并点击，Installer将发送安装指令。指令包含玩具的名字和所有者的UUID。
	- HUD接收到安装指令后，先验证UUID是否为所有者，验证通过后，先卸载已安装的同名玩具，然后发送确认回执。
	- 玩具Installer接收到回执后，将自己库存中的物件和配置文件复制到HUD的库存中，即完成玩具的安装。

	4.2. 玩具的卸载

	- 点击HUD的UNINSTALL按钮，弹出玩具的选择对话框。
	- 选择其中一个玩具并点击其按钮。
	- HUD发送确认对话框，点击确认即可卸载此玩具。